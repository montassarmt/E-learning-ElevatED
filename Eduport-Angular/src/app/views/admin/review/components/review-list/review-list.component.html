<div class="card card-body bg-transparent pb-0 border mb-4">
  <div class="table-responsive border-0">
    <table class="table table-dark-gray align-middle p-4 mb-0 table-hover">
      <thead>
        <tr>
          <th scope="col" class="border-0 rounded-start">ID</th>
          <th scope="col" class="border-0">Username</th>
          <th scope="col" class="border-0">UserSatisfaction</th>
          <th scope="col" class="border-0 rounded-end">Predict</th>
        </tr>
      </thead>

      <tbody>
        @if (isLoading) {
          <tr>
            <td colspan="4" class="text-center py-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </td>
          </tr>
        }
        @else {
          @for (user of users.slice((page - 1) * pageSize, page * pageSize); track user.id) {
            <tr>
              <td>{{ user.id }}</td>

              <td>
                <h6 class="mb-0">
                  {{ user.username }}
                </h6>
              </td>

              <td>
                @if (user.predicted) {
                  <ul class="list-inline mb-0">
                    <ng-template #t let-fill="fill">
                      <i class="far fa-star text-warning me-1">
                        @if (fill > 0) {
                          <i
                            class="fas fa-star text-warning filled"
                            [style.width.%]="fill"
                          ></i>
                        }
                      </i>
                    </ng-template>

                    <ngb-rating
                      [rate]="user.rating || 0"
                      [starTemplate]="t"
                      [readonly]="true"
                      [max]="5"
                    />
                  </ul>
                }
              </td>

              <td>
                <div class="form-check form-switch form-check-md">
                  @if (user.isPredicting) {
                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                  } @else {
                    <input
                      class="form-check-input"
                      type="checkbox"
                      [id]="'toggleUser'+user.id"
                      [checked]="user.predicted"
                      (change)="onPredictToggle(user, $event)"
                    />
                  }
                </div>
              </td>
            </tr>
          }
        }
      </tbody>
    </table>
  </div>

  <div class="card-footer bg-transparent px-0">
    <div class="d-sm-flex justify-content-sm-between align-items-sm-center">
      <p class="mb-0 text-center text-sm-start">
        Showing {{ (page - 1) * pageSize + 1 }} to 
        {{ Math.min(page * pageSize, collectionSize) }} of {{ collectionSize }} entries
      </p>

      <nav class="d-flex justify-content-center mb-0" aria-label="navigation">
        <ngb-pagination
          [(page)]="page"
          [pageSize]="pageSize"
          [collectionSize]="collectionSize"
          size="sm"
          class="pagination pagination-sm pagination-primary-soft d-inline-block d-md-flex rounded mb-0"
        >
          <ng-template ngbPaginationPrevious>
            <i class="fas fa-angle-left"></i>
          </ng-template>
          <ng-template ngbPaginationNext>
            <i class="fas fa-angle-right"></i>
          </ng-template>
        </ngb-pagination>
      </nav>
    </div>
  </div>
</div>